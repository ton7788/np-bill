<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NP-Bill | ‡∏≠‡∏≠‡∏Å‡∏ö‡∏¥‡∏•</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #1a73e8; --success: #34a853; --danger: #ea4335; }
        body { font-family: 'Sarabun', sans-serif; background: #f1f3f4; margin: 0; padding: 20px; }
        .container { max-width: 500px; margin: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        h3 { margin-top: 0; color: #3c4043; border-bottom: 2px solid #f1f3f4; padding-bottom: 10px; }
        label { display: block; margin-top: 15px; font-size: 14px; color: #5f6368; }
        input, textarea { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #dadce0; border-radius: 6px; box-sizing: border-box; font-family: 'Sarabun'; }
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        button { padding: 12px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; font-family: 'Sarabun'; transition: 0.2s; }
        .btn-main { background: var(--success); color: white; grid-column: span 2; font-size: 18px; }
        .btn-history { background: var(--primary); color: white; }
        .btn-issue { background: #fbbc04; color: #3c4043; }
        .btn-logout { background: none; color: var(--danger); width: auto; font-size: 13px; }
        #log { text-align: center; margin-top: 15px; font-weight: bold; color: var(--success); }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <span id="user-display">üë§ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
            <button class="btn-logout" onclick="logout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
        
        <div class="card">
            <h3>üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h3>
            <label>‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
            <input id="cus" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤">
            
            <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
            <textarea id="detail" rows="3" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..."></textarea>
            
            <label>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ (‡∏ö‡∏≤‡∏ó)</label>
            <input id="total" type="number" placeholder="0.00" style="font-size: 20px; font-weight: bold; color: var(--primary);">

            <div id="log"></div>

            <button class="btn-main" onclick="save()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            
            <div class="btn-group">
                <button class="btn-history" onclick="location.href='history.html'">üìä ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ö‡∏¥‡∏•</button>
                <button class="btn-issue" onclick="location.href='issue.html'">‚ö†Ô∏è ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAeXE8OJWnbrQ66L9_YW4HrMm-3EhXn0Ao",
            authDomain: "np-bill.firebaseapp.com",
            databaseURL: "https://np-bill-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "np-bill",
            storageBucket: "np-bill.firebasestorage.app",
            messagingSenderId: "516956569692",
            appId: "1:516956569692:web:961931e70b83a314072699"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const userData = JSON.parse(localStorage.getItem("user"));

        if(!userData) location.href = "login.html";
        document.getElementById("user-display").innerText = "üë§ " + userData.name;

        window.save = async () => {
            const cus = document.getElementById("cus").value;
            const total = document.getElementById("total").value;
            if(!cus || !total) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");

            try {
                await push(ref(db, "bills"), {
                    cus, detail: document.getElementById("detail").value,
                    total: parseFloat(total), by: userData.name,
                    time: new Date().toLocaleString('th-TH')
                });
                document.getElementById("log").innerText = "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
                document.getElementById("cus").value = "";
                document.getElementById("detail").value = "";
                document.getElementById("total").value = "";
                setTimeout(() => document.getElementById("log").innerText = "", 3000);
            } catch (e) { alert("‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + e.message); }
        };

        window.logout = () => { localStorage.clear(); location.href = "login.html"; };
    </script>
</body>
</html>
