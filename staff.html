<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<title>NP-Bill: ‡∏≠‡∏≠‡∏Å‡∏ö‡∏¥‡∏•</title>
<style>
  body{font-family:sans-serif;background:#f2f2f2;padding:20px;text-align:center}
  .box{max-width:500px;margin:auto;background:white;padding:30px;border-radius:15px;box-shadow:0 4px 10px rgba(0,0,0,0.1)}
  input,button,textarea{width:100%;padding:12px;margin-top:10px;border-radius:8px;border:1px solid #ddd;box-sizing:border-box}
  button{background:#28a745;color:white;border:none;cursor:pointer;font-weight:bold}
  button:hover{background:#218838}
  .btn-issue{background:#ffc107;color:#333}
  .btn-logout{background:#dc3545;margin-top:20px}
  #log{margin-top:15px;color:#28a745;font-weight:bold}
</style>
</head>
<body>

<div class="box">
  <h3>üìù ‡∏≠‡∏≠‡∏Å‡∏ö‡∏¥‡∏•‡πÉ‡∏´‡∏°‡πà</h3>
  <p id="user-display" style="color:#666"></p>

  <input id="cus" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤">
  <textarea id="detail" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤/‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£" rows="3"></textarea>
  <input id="total" type="number" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)">

  <button onclick="save()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ö‡∏¥‡∏•</button>
  <button class="btn-issue" onclick="location.href='issue.html'">‚ö†Ô∏è ‡πÅ‡∏à‡πâ‡∏á‡∏ö‡∏¥‡∏•‡∏ú‡∏¥‡∏î</button>
  <button class="btn-logout" onclick="logout()">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>

  <div id="log"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAeXE8OJWnbrQ66L9_YW4HrMm-3EhXn0Ao",
  authDomain: "np-bill.firebaseapp.com",
  databaseURL: "https://np-bill-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "np-bill",
  storageBucket: "np-bill.firebasestorage.app",
  messagingSenderId: "516956569692",
  appId: "1:516956569692:web:961931e70b83a314072699"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á
const userData = JSON.parse(localStorage.getItem("user"));
if(!userData) { location.href = "login.html"; }
document.getElementById("user-display").innerText = "‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô: " + userData.name;

window.save = async function(){
  const cus = document.getElementById("cus");
  const detail = document.getElementById("detail");
  const total = document.getElementById("total");
  const log = document.getElementById("log");

  if(!cus.value || !total.value){
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô");
    return;
  }

  try {
    await push(ref(db, "bills"), {
      cus: cus.value,
      detail: detail.value,
      total: total.value,
      by: userData.name,
      time: new Date().toLocaleString('th-TH')
    });

    log.innerHTML = "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ñ‡∏•‡∏≤‡∏ß‡∏î‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
    cus.value = ""; detail.value = ""; total.value = "";
    setTimeout(() => { log.innerHTML = ""; }, 3000);
  } catch(err) {
    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err.message);
  }
}

window.logout = ()=>{
  localStorage.clear();
  location.href="login.html";
}
</script>
</body>
</html>
